<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Entrevista Endoscopia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bibliotecas para gerar PDF -->
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f3f8fc; margin: 0; padding: 0; display: flex; justify-content: center; }
    .container { background: #ffffff; padding: 20px; margin: 20px; border-radius: 15px; max-width: 800px; width: 100%; box-shadow: 0px 6px 18px rgba(0,0,0,0.1); }
    h1,h2 { text-align: center; margin-bottom: 15px; }
    h1 { color: #666; font-size: 1.2em; }
    h2 { color: #2a6db0; font-size: 1.5em; }
    fieldset { border: none; margin-bottom: 25px; padding: 0; }
    legend { font-size: 1.2em; font-weight: bold; margin: 20px 0 10px; color: #333; }
    label { display: block; margin-top: 12px; font-weight: bold; font-size: 1.05em; color: #333; }
    input, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #bbb; font-size: 1em; box-sizing: border-box; background: #fafafa; }
    .yes-no { margin-top: 6px; display: flex; gap: 20px; flex-wrap: wrap; }
    .yes-no label { font-weight: normal; background: #f0f4f7; padding: 6px 12px; border-radius: 20px; cursor: pointer; }
    .checkbox label { display: flex; align-items: center; margin: 6px 0; font-weight: normal; }
    .checkbox input[type="checkbox"] { margin-right: 8px; width: auto; }
    .alerta { background: #fff4e6; border: 1px solid #f5c190; padding: 15px; border-radius: 10px; font-size: 0.95em; color: #333; margin-top: 15px; }
    .responsabilidade { font-size: 0.9em; color: #444; background: #f9f9f9; border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-top: 20px; }
    .botoes-acao { display: flex; flex-direction: column; gap: 10px; margin-top: 25px; }
    button { padding: 15px; color: white; border: none; border-radius: 30px; cursor: pointer; font-size: 1.2em; width: 100%; transition: background 0.3s; }
    button[type="submit"] { background: #2a6db0; }
    button[type="submit"]:hover { background: #1a4e80; }
    .btn-pdf { background: #6c757d; }
    .btn-pdf:hover { background: #5a6268; }
    .btn-pdf:disabled { background: #969ca1; cursor: not-allowed; }
    .tabela-precos { width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 0.9em; }
    .tabela-precos th, .tabela-precos td { border: 1px solid #e0c8a8; padding: 8px 12px; text-align: left; }
    .tabela-precos thead th { background-color: #fce8d1; font-weight: bold; }
    .tabela-precos td:nth-child(2) { text-align: right; font-weight: bold; }
    .info-pagamento h4 { margin-top: 20px; margin-bottom: 10px; color: #333; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hospital Israelita St. James Jarinu</h1>
    <h2>Entrevista para Elegibilidade<br> Exame de Endoscopia</h2>

    <form action="https://formsubmit.co/gestaopa@hospitalstjames.com.br" method="POST">
      <input type="hidden" name="_subject" value="üìã Nova Entrevista - Endoscopia">
      <input type="hidden" name="_next" value="https://hospitalisraelitastjames.github.io/exames/obrigado.html">
      <input type="hidden" name="_captcha" value="false">
      <input type="text" name="_honey" style="display:none">

      <fieldset>
        <legend>Dados Pessoais</legend>
        <label>Data da Entrevista:</label>
        <input type="text" id="dataEntrevista" name="Data da entrevista" readonly>
        <label>Nome completo:</label><input type="text" name="Nome do paciente" required>
        <label>Contato:</label><input type="tel" name="Telefone de contato" placeholder="(xx) xxxxx-xxxx" required>
        <label>Conv√™nio:</label><input type="text" name="Conv√™nio">
        <label>Data de nascimento:</label><input type="date" name="Data de nascimento">
      </fieldset>

      <fieldset>
        <legend>Hist√≥rico do Exame</legend>
        <label>J√° realizou esse exame?</label>
        <div class="yes-no"><label><input type="radio" name="J√° realizou endoscopia" value="sim"> Sim</label><label><input type="radio" name="J√° realizou endoscopia" value="nao"> N√£o</label></div>
        <label>Quanto tempo faz?</label><input type="text" name="Tempo desde √∫ltimo exame">
        <label>Idade:</label><input type="number" name="Idade">
        <label>Peso (kg):</label><input type="number" step="0.1" id="peso" name="Peso (kg)" oninput="calcularIMC()">
        <label>Altura (m):</label><input type="number" step="0.01" id="altura" name="Altura (m)" oninput="calcularIMC()">
        <label>IMC (autom√°tico):</label><input type="text" id="imc" name="IMC" readonly>
      </fieldset>

      <fieldset>
        <legend>Hist√≥rico de Sa√∫de</legend>
        <label>Defici√™ncia neurol√≥gica?</label><div class="yes-no"><label><input type="radio" name="Defici√™ncia neurol√≥gica" value="sim"> Sim</label><label><input type="radio" name="Defici√™ncia neurol√≥gica" value="nao"> N√£o</label></div>
        <label>Problema card√≠aco?</label><div class="yes-no"><label><input type="radio" name="Problema card√≠aco" value="sim"> Sim</label><label><input type="radio" name="Problema card√≠aco" value="nao"> N√£o</label></div>
        <label>Qual?</label><input type="text" name="Tipo de problema card√≠aco">
        <label>Problema respirat√≥rio?</label><div class="yes-no"><label><input type="radio" name="Problema respirat√≥rio" value="sim"> Sim</label><label><input type="radio" name="Problema respirat√≥rio" value="nao"> N√£o</label></div>
        <label>Qual?</label><input type="text" name="Tipo de problema respirat√≥rio">
        <label>Alergia a medicamento?</label><div class="yes-no"><label><input type="radio" name="Alergia a medicamento" value="sim"> Sim</label><label><input type="radio" name="Alergia a medicamento" value="nao"> N√£o</label></div>
        <label>Qual?</label><input type="text" name="Medicamento - alergia">
        <label>Uso de anticoagulantes?</label><div class="yes-no"><label><input type="radio" name="Uso de anticoagulantes" value="sim"> Sim</label><label><input type="radio" name="Uso de anticoagulantes" value="nao"> N√£o</label></div>
        <label>Qual?</label><input type="text" name="Qual anticoagulante">
        <label>Uso de outros medicamentos?</label><div class="yes-no"><label><input type="radio" name="Uso de outros medicamentos" value="sim"> Sim</label><label><input type="radio" name="Uso de outros medicamentos" value="nao"> N√£o</label></div>
        <label>Quais?</label><textarea name="Quais medicamentos"></textarea>
        <label>Uso de insulina ou medica√ß√£o p/ diabetes hoje?</label><div class="yes-no"><label><input type="radio" name="Uso de insulina/medica√ß√£o diabetes" value="sim"> Sim</label><label><input type="radio" name="Uso de insulina/medica√ß√£o diabetes" value="nao"> N√£o</label></div>
        <label>J√° teve hepatite B ou C?</label><div class="yes-no"><label><input type="radio" name="Hepatite B ou C" value="sim"> Sim</label><label><input type="radio" name="Hepatite B ou C" value="nao"> N√£o</label></div>
        <label>J√° foi sedado?</label><div class="yes-no"><label><input type="radio" name="J√° foi sedado" value="sim"> Sim</label><label><input type="radio" name="J√° foi sedado" value="nao"> N√£o</label></div>
        <label>Teve algum problema?</label><input type="text" name="Problema na seda√ß√£o">
        <label>J√° realizou cirurgia?</label><div class="yes-no"><label><input type="radio" name="J√° realizou cirurgia" value="sim"> Sim</label><label><input type="radio" name="J√° realizou cirurgia" value="nao"> N√£o</label></div>
        <label>Qual cirurgia?</label><input type="text" name="Qual cirurgia realizada">
        <label>Tabagista (fumante)?</label><div class="yes-no"><label><input type="radio" name="Tabagista (fumante)" value="sim"> Sim</label><label><input type="radio" name="Tabagista (fumante)" value="nao"> N√£o</label></div>
        <label>Consome bebida alco√≥lica (etilista)?</label><div class="yes-no"><label><input type="radio" name="Consome bebida alco√≥lica (etilista)" value="sim"> Sim</label><label><input type="radio" name="Consome bebida alco√≥lica (etilista)" value="nao"> N√£o</label></div>
      </fieldset>

      <fieldset>
        <legend>Para uso do hospital</legend>
        <label>Paciente necessita atestado m√©dico?</label><div class="yes-no"><label><input type="radio" name="Necessita atestado m√©dico" value="sim"> Sim</label><label><input type="radio" name="Necessita atestado m√©dico" value="nao"> N√£o</label></div>
        <label>Acompanhante necessita declara√ß√£o?</label><div class="yes-no"><label><input type="radio" name="Acompanhante necessita declara√ß√£o" value="sim"> Sim</label><label><input type="radio" name="Acompanhante necessita declara√ß√£o" value="nao"> N√£o</label></div>
        <label>Paciente recebeu preparo?</label><div class="yes-no"><label><input type="radio" name="Preparo recebido" value="sim"> Sim</label><label><input type="radio" name="Preparo recebido" value="nao"> N√£o</label></div>
      </fieldset>

      <fieldset>
        <legend>Sintomas</legend>
        <div class="checkbox">
          <label><input type="checkbox" name="Sintomas[]" value="Dificuldade para engolir"> Dificuldade para engolir</label>
          <label><input type="checkbox" name="Sintomas[]" value="Refluxo"> Refluxo</label>
          <label><input type="checkbox" name="Sintomas[]" value="Dor Abdominal"> Dor Abdominal</label>
          <label><input type="checkbox" name="Sintomas[]" value="M√° digest√£o"> M√° digest√£o</label>
          <label><input type="checkbox" name="Sintomas[]" value="Pigarro na garganta"> Pigarro na garganta</label>
          <label><input type="checkbox" name="Sintomas[]" value="N√°useas"> N√°useas</label>
          <label><input type="checkbox" name="Sintomas[]" value="Queima√ß√£o no peito"> Queima√ß√£o no peito</label>
          <label><input type="checkbox" name="Sintomas[]" value="Tosse"> Tosse</label>
          <label><input type="checkbox" name="Sintomas[]" value="Dor de garganta"> Dor de garganta</label>
          <label><input type="checkbox" name="Sintomas[]" value="Arroto"> Arroto</label>
          <label><input type="checkbox" name="Sintomas[]" value="Sensa√ß√£o de bolo na garganta"> Sensa√ß√£o de "bolo" na garganta</label>
          <label><input type="checkbox" name="Sintomas[]" value="V√¥mito"> V√¥mito</label>
          <label><input type="checkbox" name="Sintomas[]" value="Dor no peito"> Dor no peito</label>
          <label><input type="checkbox" name="Sintomas[]" value="Azia"> Azia</label>
          <label><input type="checkbox" id="outrosSintomasCheck" name="Sintomas[]" value="Outros"> Outros</label>
        </div>
        <div id="campoOutrosSintomas" style="display:none; margin-top:10px;">
          <label>Descreva os outros sintomas:</label>
          <textarea name="Outros sintomas"></textarea>
        </div>
      </fieldset>

      <fieldset>
        <legend>Custos Adicionais e Pagamento</legend>
        <div class="alerta info-pagamento">
          <p><strong>Aten√ß√£o: Pacientes Particulares ou com Conv√™nios sem Cobertura para itens adicionais.</strong></p>
          <p>O pagamento do valor base do exame (<strong>Endoscopia: R$ 600,00</strong>) √© realizado <strong>antes</strong> do procedimento. Custos adicionais, se necess√°rios, s√£o apurados e pagos <strong>ap√≥s</strong> o exame.</p>
          <p>Como o paciente sai do exame sob efeito de seda√ß√£o, √© fundamental que o <strong>acompanhante</strong> esteja ciente e preparado para realizar o pagamento de eventuais valores extras.</p>
          <h4>Tabela de Poss√≠veis Custos Adicionais:</h4>
          <table class="tabela-precos"><thead><tr><th>Servi√ßo Adicional</th><th>Valor (R$)</th><th>Observa√ß√£o</th></tr></thead><tbody><tr><td>Coleta de Bi√≥psia</td><td>216,00</td><td>-</td></tr><tr><td>An√°lise Anatomopatol√≥gica</td><td>118,00</td><td>Por amostra</td></tr><tr><td>Polipectomia (P√≥lipo de EDA)</td><td>600,00</td><td>Caso tenha</td></tr><tr><td>Hemostasia</td><td>1.000,00</td><td>Caso necess√°rio</td></tr><tr><td>Hemoclipes</td><td>678,00</td><td>Caso necess√°rio</td></tr><tr><td>Mucosectomia</td><td>1.000,00</td><td>Caso tenha</td></tr><tr><td>Interna√ß√£o (12h)</td><td>350,00</td><td>Se for necess√°rio</td></tr></tbody></table>
          <h4>Formas de Pagamento:</h4><p>Dinheiro, PIX, D√©bito e Cr√©dito. O parcelamento pode ser negociado a depender do valor total.</p>
        </div>
        <p>Foram claras as informa√ß√µes sobre custos e pagamento?</p>
        <div class="yes-no"><label><input type="radio" name="Ciencia sobre custos" value="sim" required> Sim</label><label><input type="radio" name="Ciencia sobre custos" value="nao"> N√£o</label></div>
        <p>Est√° ciente e de acordo com as condi√ß√µes acima?</p>
        <div class="yes-no"><label><input type="radio" name="Acordo com custos" value="sim" required> Sim</label><label><input type="radio" name="Acordo com custos" value="nao"> N√£o</label></div>
      </fieldset>

      <fieldset> <div class="alerta"> <p><strong>Importante:</strong></p> <p>O atestado m√©dico √© exclusivamente para o <strong>dia do exame</strong> e n√£o abrange os dias de preparo.</p> </div> </fieldset>
      
      <fieldset> <legend>Declara√ß√£o de Responsabilidade</legend> <div class="responsabilidade"> <p>Declaro que todas as informa√ß√µes prestadas neste formul√°rio s√£o verdadeiras e de minha inteira responsabilidade. Estou ciente de que informa√ß√µes incorretas podem impactar na seguran√ßa e no resultado do exame.</p> </div> <div class="yes-no"><label><input type="radio" name="Declara√ß√£o de responsabilidade" value="declaro" required> Declaro que as informa√ß√µes s√£o verdadeiras</label></div> </fieldset>
      
      <div class="botoes-acao">
        <button type="button" class="btn-pdf" id="btn-pdf-endo" onclick="gerarPDF()">üìÑ Baixar Preparo em PDF</button>
        <button type="submit">üì® Enviar Formul√°rio</button>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const hoje = new Date();
      const dd = String(hoje.getDate()).padStart(2,'0');
      const mm = String(hoje.getMonth()+1).padStart(2,'0');
      const yyyy = hoje.getFullYear();
      document.getElementById("dataEntrevista").value = `${dd}/${mm}/${yyyy}`;
      
      document.getElementById("outrosSintomasCheck").addEventListener("change", function() {
        document.getElementById("campoOutrosSintomas").style.display = this.checked ? "block" : "none";
      });
    });

    function calcularIMC() {
      const peso = parseFloat(document.getElementById("peso")?.value);
      const altura = parseFloat(document.getElementById("altura")?.value);
      if (peso > 0 && altura > 0) {
        const imc = (peso / (altura * altura)).toFixed(2);
        document.getElementById("imc").value = imc;
      } else {
        document.getElementById("imc").value = "";
      }
    }

    function gerarPDF() {
      const btn = document.getElementById('btn-pdf-endo');
      btn.disabled = true;
      btn.innerText = 'Gerando PDF...';

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'mm', format: 'a4' });
      
      let y = 15;
      const margin = 15;
      const maxWidth = doc.internal.pageSize.width - margin * 2;

      // --- Fun√ß√µes Auxiliares ---
      function addHeader() {
        doc.setFontSize(18);
        doc.setTextColor(42, 109, 176); // #2a6db0
        doc.text("Preparo e Custos - Endoscopia", doc.internal.pageSize.width / 2, y, { align: 'center' });
        y += 10;
        doc.setDrawColor(200);
        doc.line(margin, y, doc.internal.pageSize.width - margin, y);
        y += 15;
      }
      
      function checkPageBreak(currentY, neededHeight = 20) {
        if (currentY + neededHeight > doc.internal.pageSize.height - margin) {
          doc.addPage();
          y = margin;
          return margin;
        }
        return currentY;
      }

      function addTitle(title, size = 14) {
        y = checkPageBreak(y);
        doc.setFontSize(size);
        doc.setTextColor(42, 109, 176);
        doc.text(title, margin, y);
        y += (size / 2);
      }

      function addSubTitle(title) {
        y = checkPageBreak(y);
        doc.setFontSize(11);
        doc.setTextColor(51, 51, 51);
        doc.setFont('helvetica', 'bold');
        doc.text(title, margin, y);
        y += 6;
      }

      function addText(text) {
        y = checkPageBreak(y);
        doc.setFontSize(10);
        doc.setTextColor(51, 51, 51);
        doc.setFont('helvetica', 'normal');
        const lines = doc.splitTextToSize(text, maxWidth);
        // Verifica se o bloco de texto cabe na p√°gina
        if (y + (lines.length * 5) > doc.internal.pageSize.height - margin) {
            doc.addPage();
            y = margin;
        }
        doc.text(lines, margin, y);
        y += lines.length * 5 + 4;
      }
      
      function addListItem(text) {
        y = checkPageBreak(y, 10);
        doc.setFontSize(10);
        doc.setTextColor(51, 51, 51);
        doc.setFont('helvetica', 'normal');
        const lines = doc.splitTextToSize(text, maxWidth - 5);
        doc.text("-", margin, y);
        doc.text(lines, margin + 5, y);
        y += lines.length * 5 + 2;
      }

      // --- Constru√ß√£o do PDF ---
      addHeader();

      addTitle("CENTRO DE ENDOSCOPIA DIGESTIVA");
      addSubTitle("Devo realizar algum preparo?");
      addText("Para a realiza√ß√£o de um exame seguro, √© necess√°rio um jejum absoluto (√°gua e alimentos) por 12 horas. Este cuidado √© muito importante, pois minimiza o risco do refluxo de alimentos que podem ir para o pulm√£o.");

      y += 5;
      addSubTitle("INFORMA√á√ïES IMPORTANTES");
      addListItem("Os medicamentos para DIABETES e INSULINA n√£o devem ser tomados no dia do exame, devido ao risco de hipoglicemia.");
      addListItem("Os rem√©dios di√°rios de press√£o alta e convuls√£o devem ser tomados at√© 2 horas antes do exame, com pouca √°gua (50ml).");
      addListItem("No dia do exame n√£o use esmalte, acess√≥rios como joias e bijuterias.");
      addListItem("Trazer uma toalha de rosto.");
      addListItem("Vir acompanhado com maior de 18 anos.");
      addListItem("Traga os exames realizados anteriormente (Colonoscopia, Endoscopia, Tomografia, ultrassonografia(s).).");
      addListItem("Comparecer 20 minutos antes do hor√°rio agendado.");
      addText("Todo paciente dever√° estar acompanhado de uma pessoa maior de 18 anos e n√£o pode dirigir ap√≥s o exame. Respeitando crit√©rios de seguran√ßa e as normas da legisla√ß√£o Brasileira (SS-169/96, CFM 1.409/94 e SS-SP 2/2006) √© obrigat√≥ria a presen√ßa de um acompanhante at√© o retorno do paciente √† sua resid√™ncia. √â proibido dirigir e tomar decis√µes importantes nas 12 horas seguintes ao exame, pois, devido aos medicamentos usados, o paciente pode se manter sonolento e com retardo dos reflexos.");
      
      y = checkPageBreak(y, 80); // Verifica se h√° espa√ßo para a se√ß√£o de custos
      
      y += 5;
      doc.setDrawColor(200);
      doc.line(margin, y, doc.internal.pageSize.width - margin, y);
      y += 10;
      
      addTitle("Custos Adicionais e Pagamento");
      addText("Aten√ß√£o: Pacientes Particulares ou com Conv√™nios sem Cobertura para itens adicionais.");
      addText("O pagamento do valor base do exame (Endoscopia: R$ 600,00) √© realizado antes do procedimento. Custos adicionais, se necess√°rios, s√£o apurados e pagos ap√≥s o exame.");
      addText("Como o paciente sai do exame sob efeito de seda√ß√£o, √© fundamental que o acompanhante esteja ciente e preparado para realizar o pagamento de eventuais valores extras.");
      
      y += 2;
      doc.autoTable({
        startY: y,
        head: [['Servi√ßo Adicional', 'Valor (R$)', 'Observa√ß√£o']],
        body: [
          ['Coleta de Bi√≥psia', '216,00', '-'],
          ['An√°lise Anatomopatol√≥gica', '118,00', 'Por amostra'],
          ['Polipectomia (P√≥lipo de EDA)', '600,00', 'Caso tenha'],
          ['Hemostasia', '1.000,00', 'Caso necess√°rio'],
          ['Hemoclipes', '678,00', 'Caso necess√°rio'],
          ['Mucosectomia', '1.000,00', 'Caso tenha'],
          ['Interna√ß√£o (12h)', '350,00', 'Se for necess√°rio'],
        ],
        theme: 'grid',
        headStyles: { fillColor: [240, 244, 247], textColor: 51 },
        styles: { fontSize: 9, cellPadding: 2 }
      });
      y = doc.lastAutoTable.finalY + 10;

      addSubTitle("Formas de Pagamento:");
      addText("Dinheiro, PIX, D√©bito e Cr√©dito. O parcelamento pode ser negociado a depender do valor total.");

      // Salvar
      doc.save('preparo-endoscopia.pdf');
      btn.disabled = false;
      btn.innerText = 'üìÑ Baixar Preparo em PDF';
    }
  </script>
</body>
</html>
